<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCC 138exemplo 01</title>
</head>
<body>
    <h1>DCC 138exemplo 01</h1>
    <canvas></canvas>
    <p>Por Pedro Marques</p>
    <script>
        let canvas = document.querySelector("canvas");
        let cont = canvas.getContext("2d");
        canvas.width = 480;
        canvas.height = 320;
        let p = {

             x : 100,
             vx : 0,
             ax : 0,
             y : 100,
             vy : 0,
             ay : 0,
             cor : "white",
            desenhar: desenhaElemento ,
            mover: moverElemento,
        };
        const sprites = [];
        for (let ne = 0; ne < 20; ne++) {
           
            let e = {
    
                x : canvas.width * Math.random(),
                vx : 0,
                ax : 0,
                y : canvas.height * Math.random(),
                vy : 0,
                ay : 0, 
                 cor : "red",
                 desenhar: desenhaElemento ,
                mover : moverElemento , 
                controla : perseguirAlvo,
            
            };
            sprites.push(e);
        }

        const K = 80;
        let t0;
        let dt;
        requestAnimationFrame (desenha);

        function desenha(t){
            t0 = t0 ?? t;
            dt = (t - t0)/1000;
            // desenha fundo
            cont.fillStyle = "black";
            cont.fillRect(0,0,canvas.width,canvas.height);

            p.mover();
            p.desenhar();
            
            for (let s = 0; s < sprites; s++) {
                const sprite = sprites[s];
                
                //Controladores
                sprites[0].controlar(p);
                //Atualiza estado
                sprites[0].mover();
                // desenha elementos
                sprites[0].desenhar();
            }
            


            requestAnimationFrame (desenha);
            t0 = t;
        }
            function moverElemento (){
            this.vx =this.vx +this.ax*dt;
            this.x =this.x +this.vx*dt;  
            this.vy = this.vy + this.ay*dt;
            this.y = this.y + this.vy*dt;   
            }

            function desenhaElemento (){
             ctx.fillStyle = this.cor;
            ctx.fillRect(this.x, this.y ,20,20);
            }

            function perseguirAlvo (alvo){
            e.ax = 0.5*(alvo.y - this.y) - 0.2*this.vx;
            eay = 0.5*(alvo.x - this.x) - 0.2*this.vy;
            }

            function evitarAlvo (alvo){
            e.ax = -0.5*(alvo.y - this.y) - 0.2*this.vx;
            eay = -0.5*(alvo.x - this.x) - 0.2*this.vy;
            }



        addEventListener("keydown", teclaPressionada);
        addEventListener("Keyup", teclaSolta);
        function teclaPressionada(event) {
            // controle de velocidade
            switch (event.key) {
                case "ArrowUp":
                    p.ay = -K;
                    break;
                case "ArrowDown":
                    p.ay = +K;
                    break;

                    case "ArrowLeft":
                    p.ax = -K;
                    break;
                case "ArrowRight":
                    p.ax = +K;
                    break;
                   
                }
        
        }
        function teclaSolta(event) {
            // controle de velocidade
            switch (event.key) {
                case "ArrowUp":
                  
                    p.ay = 0;
                    break;
                case "ArrowDown":
                   
                    p.ay = 0;
                    break;

                case "ArrowLeft":
                    
                    p.ax = 0;
                    break;
                case "ArrowRight":
                    p.ax = 0;
                    break;

            }
        
        }
    </script>
</body>
</html>